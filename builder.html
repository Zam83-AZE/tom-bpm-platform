<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOM Builder v8.1 (Pro Editor + Format)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify.min.js"></script>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            height: 100vh; 
            display: flex; 
            overflow: hidden; 
            background: #2d2d2d; 
        }

        /* PANELS */
        .sidebar { 
            width: 250px; 
            min-width: 200px; 
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%); 
            color: #fff; 
            display: flex; 
            flex-direction: column; 
        }
        .resizer-h { width: 5px; background: #1a252f; cursor: col-resize; }
        .main-area { flex: 1; display: flex; flex-direction: column; background: #f5f7fa; min-width: 400px; }
        .editor-panel { flex: 1; padding: 20px; overflow-y: auto; background: #fff; min-height: 200px; }
        .resizer-v { height: 5px; background: #bdc3c7; cursor: row-resize; }
        .preview-panel { height: 300px; min-height: 100px; background: #1e1e1e; color: #4ec9b0; display: flex; flex-direction: column; }

        /* CODE EDITOR STYLES (Updated) */
        .code-wrapper { 
            position: relative; 
            margin-top: 5px; 
            border: 1px solid #2c3e50;
            border-radius: 4px;
            overflow: hidden;
        }
        
        /* Editor Toolbar */
        .editor-tools {
            background: #2c3e50;
            padding: 5px;
            display: flex;
            justify-content: flex-end;
            gap: 5px;
        }

        .btn-tool {
            background: #4a5a6a;
            color: #fff;
            border: none;
            padding: 4px 10px;
            font-size: 11px;
            cursor: pointer;
            border-radius: 3px;
            font-weight: bold;
            transition: background 0.2s;
        }
        .btn-tool:hover { background: #3498db; }

        .CodeMirror {
            height: 200px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
        }

        /* Fullscreen Mode */
        .code-wrapper.fullscreen {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: #282a36;
            z-index: 2000;
            border: none;
            border-radius: 0;
            display: flex;
            flex-direction: column;
        }
        .code-wrapper.fullscreen .editor-tools { padding: 10px; background: #1e1e1e; }
        .code-wrapper.fullscreen .CodeMirror { flex: 1; height: auto !important; }
        .code-wrapper.fullscreen .btn-tool { font-size: 13px; padding: 8px 15px; }
        .code-wrapper.fullscreen .btn-maximize { background: #e74c3c; }

        /* STANDARD UI */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 12px; color: #34495e; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #bdc3c7; border-radius: 4px; font-size: 13px; }
        
        .file-manager { padding: 15px; background: #34495e; border-bottom: 2px solid #2c3e50; }
        .btn-file, .btn-browse, .btn-save { padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; border: none; color: white; font-size: 12px; }
        .btn-file { background: #e67e22; } .btn-browse { background: #3498db; } .btn-save { background: #27ae60; }
        
        .activity-list { flex: 1; overflow-y: auto; list-style: none; background: #fff; }
        .activity-item { padding: 10px 15px; border-bottom: 1px solid #ecf0f1; cursor: pointer; color: #2c3e50; display:flex; justify-content:space-between; font-size:13px;}
        .activity-item:hover { background: #34495e; color: #fff; }
        .activity-item.active { background: #3498db; color: #fff; font-weight: bold; }
        
        .tab-container { display: flex; background: #252526; border-bottom: 1px solid #3e3e42; }
        .tab-btn { flex: 1; padding: 8px; background: transparent; color: #888; border: none; cursor: pointer; font-weight: bold; }
        .tab-btn.active { color: #fff; background: #1e1e1e; border-bottom: 2px solid #3498db; }
        .tab-content { flex: 1; overflow: hidden; display: none; }
        .tab-content.active { display: block; height: 100%; }
        #jsonPreview { padding: 10px; margin: 0; height: 100%; overflow: auto; font-size: 11px; }
        #cy { width: 100%; height: 100%; }
        
        .btn-icon { background:none; border:none; color:#e74c3c; cursor:pointer; font-weight:bold;}
        .config-section { background: #f8f9fa; padding: 15px; border: 1px solid #e0e0e0; border-radius: 4px; }
        .sub-item { background: #fff; padding: 5px; margin-bottom: 5px; border: 1px solid #ddd; display: flex; gap: 5px; }
        .btn-small { padding: 2px 6px; font-size: 10px; cursor: pointer; background: #95a5a6; color: #fff; border: none; }
        .btn-add { background: #27ae60; color: #fff; border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; float: right; }
        .list-header { padding: 10px 15px; background: #ecf0f1; color: #333; font-weight: bold; font-size: 12px; }
    </style>
</head>
<body>

    <div class="sidebar" style="width: 280px;">
        <div class="file-manager">
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button class="btn-file" onclick="createNewFile()" style="flex:1">+ Yeni</button>
                <label class="btn-browse" style="flex:1; text-align:center">üìÇ Y√ºkl…ô
                    <input type="file" id="fileUploader" accept=".js" multiple style="display:none" onchange="handleFileUpload(this)">
                </label>
            </div>
            <select class="process-list" id="processSelector" onchange="switchProcess(this.value)" style="width:100%"></select>
        </div>
        <div class="list-header">Addƒ±mlar <button class="btn-add" onclick="addActivity()">+</button></div>
        <ul class="activity-list" id="activityList"></ul>
    </div>

    <div class="resizer-h" id="dragMeH"></div>

    <div class="main-area">
        <div class="editor-panel" id="editorPanel" style="height: 60%;">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:5px;">
                <h3 style="margin:0; color:#2c3e50;">‚öôÔ∏è Redaktor</h3>
                <button class="btn-save" onclick="downloadCurrentFile()">üíæ Saxla</button>
            </div>

            <div class="form-group"><label>ID</label><input type="text" id="act_id" oninput="updateActivity('id',this.value)"></div>
            <div class="form-group"><label>Ad</label><input type="text" id="act_name" oninput="updateActivity('name',this.value)"></div>
            <div class="form-group"><label>Rol</label><input type="text" id="act_role" oninput="updateActivity('role',this.value)"></div>
            <div class="form-group"><label>T…ôsvir</label><textarea id="act_description" rows="2" oninput="updateActivity('description',this.value)"></textarea></div>
            
            <div class="form-group">
                <label>Tip</label>
                <select id="act_type" onchange="updateActivity('type',this.value)">
                    <option value="UserTask">User Task</option>
                    <option value="ServiceTask">Service Task</option>
                    <option value="SubProcess">Sub Process</option>
                    <option value="EndEvent">End Event</option>
                </select>
            </div>

            <div id="serviceConfig" class="config-section service" style="display:none">
                <div class="form-group"><label>Service Name</label><input type="text" id="act_serviceName" oninput="updateActivity('serviceName',this.value)"></div>
                
                <label>Simulation (JS Code)</label>
                <div class="code-wrapper" id="codeWrapper">
                    <div class="editor-tools">
                        <button class="btn-tool" onclick="formatCode()">üßπ Format</button>
                        <button class="btn-tool btn-maximize" onclick="toggleCodeFullscreen()">‚õ∂ Geni≈ül…ôndir</button>
                    </div>
                    <textarea id="act_simulation"></textarea>
                </div>
            </div>

            <div id="subProcessConfig" class="config-section subprocess" style="display:none">
                <div class="form-group"><label>Process Name</label><input type="text" id="act_processName" oninput="updateActivity('processName',this.value)"></div>
            </div>

            <hr>
            <div class="form-group"><label>üìù Inputlar</label><div id="inputsList"></div><button class="btn-small add" onclick="addInput()">+ Input</button></div>
            <hr>
            <div class="form-group"><label>üîÄ Ke√ßidl…ôr</label><div id="transitionsList"></div><button class="btn-small add" onclick="addTransition()">+ Ke√ßid</button></div>
        </div>

        <div class="resizer-v" id="dragMeV"></div>

        <div class="preview-panel" style="height: 40%;">
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('json')">JSON</button>
                <button class="tab-btn" onclick="switchTab('visual')">DIAQRAM</button>
            </div>
            <div id="tab-json" class="tab-content active"><pre id="jsonPreview">Fayl se√ßin...</pre></div>
            <div id="tab-visual" class="tab-content"><div id="cy"></div></div>
        </div>
    </div>

    <script>
        // --- CODEMIRROR INIT ---
        let cmEditor;
        window.onload = function() {
            cmEditor = CodeMirror.fromTextArea(document.getElementById("act_simulation"), {
                mode: "javascript",
                theme: "dracula",
                lineNumbers: true,
                autoCloseBrackets: true,
                lineWrapping: true
            });

            cmEditor.on("change", (cm) => {
                if(selectedActivityIndex !== null && TOM_REGISTRY[currentProcessName]) {
                    const a = TOM_REGISTRY[currentProcessName].activities[selectedActivityIndex];
                    a.simulation = cm.getValue();
                    updateJSONPreview();
                }
            });

            console.log("%cüöÄ TOM Builder v8.1", "color:#27ae60;font-size:16px;font-weight:bold");
        };

        // ‚úÖ NEW: FORMATTER FUNCTION
        function formatCode() {
            if(!cmEditor) return;
            const raw = cmEditor.getValue();
            // js_beautify kitabxanasƒ±nƒ± istifad…ô edirik
            const formatted = js_beautify(raw, { indent_size: 2, space_in_empty_paren: true });
            cmEditor.setValue(formatted);
        }

        function toggleCodeFullscreen() {
            const wrapper = document.getElementById('codeWrapper');
            wrapper.classList.toggle('fullscreen');
            const btn = wrapper.querySelector('.btn-maximize');
            btn.innerText = wrapper.classList.contains('fullscreen') ? "‚úñ Baƒüla" : "‚õ∂ Geni≈ül…ôndir";
            cmEditor.refresh();
        }

        // --- RESIZABLE LOGIC ---
        const resizerH = document.getElementById('dragMeH'), sidebar = document.querySelector('.sidebar');
        const resizerV = document.getElementById('dragMeV'), editorPanel = document.querySelector('.editor-panel'), previewPanel = document.querySelector('.preview-panel');

        resizerH.addEventListener('mousedown', (e) => { document.addEventListener('mousemove', resizeH); document.addEventListener('mouseup', stopResizeH); });
        function resizeH(e) { sidebar.style.width = e.clientX + 'px'; }
        function stopResizeH() { document.removeEventListener('mousemove', resizeH); }

        resizerV.addEventListener('mousedown', (e) => { document.addEventListener('mousemove', resizeV); document.addEventListener('mouseup', stopResizeV); });
        function resizeV(e) { const h = e.clientY - 40; editorPanel.style.height = h + 'px'; previewPanel.style.height = `calc(100vh - ${h}px)`; }
        function stopResizeV() { document.removeEventListener('mousemove', resizeV); if(cy) cy.resize(); }

        // --- CORE LOGIC ---
        window.TOM_REGISTRY = {};
        let currentProcessName = null;
        let selectedActivityIndex = null;
        let cy = null;

        function createNewFile() { 
            const n = prompt("Proses adƒ±:"); 
            if(n){ TOM_REGISTRY[n] = { processName: n, startActivity: "", activities: [], transitions: [] }; refreshProcessList(); document.getElementById('processSelector').value=n; switchProcess(n); } 
        }
        function refreshProcessList() { 
            const s=document.getElementById('processSelector'); s.innerHTML='<option>-- Se√ß --</option>'; 
            Object.keys(TOM_REGISTRY).forEach(k=>{ const o=document.createElement('option'); o.value=o.text=k; s.add(o) });
        }
        function switchProcess(n) { 
            currentProcessName=n; document.getElementById('editorPanel').style.display='none'; selectedActivityIndex=null; 
            renderActivityList(); updateJSONPreview(); 
            if(document.getElementById('tab-visual').classList.contains('active')) renderVisualGraph();
        }
        function handleFileUpload(input) { 
            Array.from(input.files).forEach(f=>{ const r=new FileReader(); r.onload=e=>{ try{ eval(e.target.result); refreshProcessList(); }catch(er){alert(er);} }; r.readAsText(f); }); input.value=''; 
        }

        function downloadCurrentFile() {
            if (!currentProcessName) return alert("Z…ôhm…ôt olmasa proses se√ßin!");
            
            // Orijinal obyekti g√∂t√ºr√ºr√ºk
            const originalData = TOM_REGISTRY[currentProcessName];
            
            // 1. D…ôrin kopyasƒ±nƒ± yaradƒ±rƒ±q (Orijinalƒ± pozmamaq √º√ß√ºn)
            const dataToSave = JSON.parse(JSON.stringify(originalData));
            const codeMap = {};

            // 2. Kodlarƒ± gizl…ôdirik (Placeholder metodu)
            // Simulation kodunu JSON.stringify-dan qorumaq √º√ß√ºn onu x√ºsusi tokenl…ô …ôv…ôz edirik
            dataToSave.activities.forEach((act, index) => {
                if (act.simulation) {
                    // Unikal bir a√ßar yaradƒ±rƒ±q
                    const token = `@@SIMULATION_CODE_BLOCK_${index}@@`;
                    
                    // Real kodu yadda saxlayƒ±rƒ±q
                    codeMap[token] = act.simulation;
                    
                    // Obyekt…ô tokeni yazƒ±rƒ±q
                    act.simulation = token;
                }
            });

            // 3. JSON yaradƒ±rƒ±q (Artƒ±q kod xarab olmayacaq, √ß√ºnki i√ßind…ô sad…ôc…ô token var)
            let jsonString = JSON.stringify(dataToSave, (k, v) => typeof v === 'function' ? v.toString() : v, 4);

            // 4. Tokenl…ôri Real Kodla …ôv…ôz edirik
            Object.keys(codeMap).forEach(token => {
                // JSON-da token bel…ô g√∂r√ºn√ºr: "@@SIMULATION_CODE_BLOCK_0@@" (Dƒ±rnaq i√ßind…ô)
                // Biz onu dƒ±rnaqsƒ±z real kodla …ôv…ôz edirik
                const placeholder = `"${token}"`;
                const realCode = codeMap[token];
                
                jsonString = jsonString.replace(placeholder, realCode);
            });

            // 5. Faylƒ± y√ºkl…ôyirik
            const fileContent = `/**
 * TOM Process - Generated by Builder v8.1
 * ${new Date().toLocaleString('az-AZ')}
 */

window.TOM_REGISTRY = window.TOM_REGISTRY || {};

window.TOM_REGISTRY["${currentProcessName}"] = ${jsonString};`;

            const blob = new Blob([fileContent], { type: "text/javascript" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tom_${currentProcessName}.js`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert("‚úÖ Fayl uƒüurla v…ô t…ôhl√ºk…ôsiz ≈ü…ôkild…ô yadda saxlanƒ±ldƒ±!");
        }

        function renderActivityList() {
            const l=document.getElementById('activityList'); l.innerHTML=""; const p=TOM_REGISTRY[currentProcessName]; if(!p) return;
            p.activities.forEach((a,i)=>{
                const li=document.createElement('li'); li.className=`activity-item ${i===selectedActivityIndex?'active':''}`;
                li.innerHTML=`<span>${a.name}</span> <button class='btn-icon' onclick="deleteActivity(event,${i})">√ó</button>`;
                li.onclick=()=>loadActivity(i); l.appendChild(li);
            });
        }

        function loadActivity(i) {
            selectedActivityIndex=i; const p=TOM_REGISTRY[currentProcessName]; if(!p) return;
            const a=p.activities[i]; document.getElementById('editorPanel').style.display='block'; renderActivityList();
            
            ['id','name','role','description','type','serviceName','processName'].forEach(f=>{
                const el=document.getElementById('act_'+f); if(el) el.value=a[f]||"";
            });

            if(cmEditor) {
                let simVal = "";
                if (typeof a.simulation === 'function') simVal = a.simulation.toString();
                else if (a.simulation) simVal = a.simulation;
                cmEditor.setValue(simVal || "");
                setTimeout(() => cmEditor.refresh(), 10); 
            }

            document.getElementById('serviceConfig').style.display=a.type==='ServiceTask'?'block':'none';
            document.getElementById('subProcessConfig').style.display=a.type==='SubProcess'?'block':'none';
            renderInputs(a); renderTransitions(a);
        }

        function updateActivity(f,v) { 
            if(selectedActivityIndex===null) return; 
            const a=TOM_REGISTRY[currentProcessName].activities[selectedActivityIndex]; 
            a[f]=v; 
            if(f==='id' && TOM_REGISTRY[currentProcessName].startActivity==='') TOM_REGISTRY[currentProcessName].startActivity=v;
            if(f==='type') loadActivity(selectedActivityIndex);
            updateJSONPreview(); renderActivityList(); 
        }

        function addActivity() { 
            if(!currentProcessName) return alert("Se√ßin!");
            const p=TOM_REGISTRY[currentProcessName]; 
            p.activities.push({id:"Step_"+(p.activities.length+1),name:"Yeni",type:"UserTask",inputs:[]}); 
            if(!p.startActivity) p.startActivity=p.activities[0].id;
            renderActivityList(); loadActivity(p.activities.length-1); updateJSONPreview();
        }
        function deleteActivity(e,i) { e.stopPropagation(); if(!confirm("Silinsin?")) return; TOM_REGISTRY[currentProcessName].activities.splice(i,1); selectedActivityIndex=null; document.getElementById('editorPanel').style.display='none'; renderActivityList(); updateJSONPreview(); }

        function renderInputs(a) {
            const l=document.getElementById('inputsList'); l.innerHTML=""; 
            (a.inputs||[]).forEach((inp,i)=>{
                const safe=(s)=>(s||'').replace(/"/g,'&quot;');
                let h=`<div class='sub-item' style='flex-wrap:wrap'><input value="${safe(inp.name)}" placeholder="Key" style="flex:1" oninput="updInp(${i},'name',this.value)"><input value="${safe(inp.label)}" placeholder="Label" style="flex:1" oninput="updInp(${i},'label',this.value)"><select style="width:60px" onchange="updInp(${i},'type',this.value)"><option value="text" ${inp.type==='text'?'selected':''}>Txt</option><option value="number" ${inp.type==='number'?'selected':''}>Num</option><option value="select" ${inp.type==='select'?'selected':''}>Sel</option></select><button class='btn-small delete' onclick="delInp(${i})">√ó</button>`;
                if(inp.type==='select') h+=`<div style='width:100%;margin-top:5px'><input value="${safe(inp.options)}" placeholder="Opsiyalar" style="width:100%;border-color:#3498db" oninput="updInp(${i},'options',this.value)"></div>`;
                l.innerHTML+=h+`</div>`;
            });
        }

        function renderTransitions(a) {
            const l=document.getElementById('transitionsList'); l.innerHTML=""; 
            (TOM_REGISTRY[currentProcessName].transitions||[]).forEach((t,globalI)=>{
                if(t.from===a.id) l.innerHTML+=`<div class='sub-item'>TO:<input value="${t.to}" style="flex:1" oninput="updTrans(${globalI},'to',this.value)">IF:<input value="${t.condition||''}" style="flex:1" oninput="updTrans(${globalI},'condition',this.value)"><button class='btn-small delete' onclick="delTrans(${globalI})">√ó</button></div>`;
            });
        }

        window.addInput=()=>{ const a=getCurrentAct(); if(!a)return; if(!a.inputs)a.inputs=[]; a.inputs.push({name:"",type:"text"}); loadActivity(selectedActivityIndex); updateJSONPreview(); }
        window.updInp=(i,f,v)=>{ const a=getCurrentAct(); a.inputs[i][f]=v; if(f==='type')loadActivity(selectedActivityIndex); updateJSONPreview(); }
        window.delInp=(i)=>{ const a=getCurrentAct(); a.inputs.splice(i,1); loadActivity(selectedActivityIndex); updateJSONPreview(); }
        
        window.addTransition=()=>{ const a=getCurrentAct(); const p=TOM_REGISTRY[currentProcessName]; if(!p.transitions)p.transitions=[]; p.transitions.push({from:a.id,to:""}); loadActivity(selectedActivityIndex); updateJSONPreview(); }
        window.updTrans=(i,f,v)=>{ TOM_REGISTRY[currentProcessName].transitions[i][f]=v; updateJSONPreview(); }
        window.delTrans=(i)=>{ TOM_REGISTRY[currentProcessName].transitions.splice(i,1); loadActivity(selectedActivityIndex); updateJSONPreview(); }

        function getCurrentAct() { return selectedActivityIndex!==null?TOM_REGISTRY[currentProcessName].activities[selectedActivityIndex]:null; }
        function updateJSONPreview() {
            if(currentProcessName) {
                document.getElementById('jsonPreview').innerText=JSON.stringify(TOM_REGISTRY[currentProcessName],null,2);
                if(document.getElementById('tab-visual').classList.contains('active')) renderVisualGraph();
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
            document.querySelector(`button[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById('tab-'+tab).classList.add('active');
            if(tab==='visual') setTimeout(()=>{ if(cy)cy.resize(); else renderVisualGraph(); },100);
        }

        async function renderVisualGraph() {
            if (!currentProcessName) return;
            const p = TOM_REGISTRY[currentProcessName];
            if (typeof cytoscape('core', 'dagre') !== 'function') { try { cytoscape.use(cytoscapeDagre); } catch(e) {} }
            let elements = [];
            p.activities.forEach(a => {
                let cl='default'; if(a.type==='UserTask')cl='user'; else if(a.type==='ServiceTask')cl='service'; else if(a.type==='SubProcess')cl='sub'; else if(a.type==='EndEvent')cl=!a.id.toLowerCase().includes('reject')?'success':'fail';
                elements.push({ group:'nodes', data:{id:a.id,label:a.name,type:a.type,subName:a.processName}, classes:cl });
            });
            (p.transitions||[]).forEach(t => {
                if(t.from&&t.to) elements.push({ group:'edges', data:{source:t.from,target:t.to,label:t.condition?t.condition.substring(0,15)+'...':''} });
            });
            if(cy) cy.destroy();
            cy = cytoscape({
                container: document.getElementById('cy'), elements: elements,
                style: [
                    { selector:'node', style:{'label':'data(label)','color':'#fff','text-valign':'center','text-halign':'center','font-size':'11px','width':'120px','height':'50px','shape':'round-rectangle','background-color':'#7f8c8d'} },
                    { selector:'.user', style:{'background-color':'#3498db'} }, { selector:'.service', style:{'background-color':'#9b59b6','shape':'rectangle'} }, { selector:'.sub', style:{'background-color':'#e67e22','shape':'cut-rectangle'} }, { selector:'.success', style:{'background-color':'#2ecc71','shape':'ellipse'} }, { selector:'.fail', style:{'background-color':'#e74c3c','shape':'ellipse'} },
                    { selector:'edge', style:{'width':2,'line-color':'#bdc3c7','target-arrow-color':'#bdc3c7','target-arrow-shape':'triangle','curve-style':'bezier','label':'data(label)','font-size':'9px','color':'#bdc3c7','text-background-color':'#1e1e1e','text-background-opacity':1} }
                ],
                layout: { name:'dagre', rankDir:'TB', padding:30 }
            });
            cy.on('tap','node',e=>{ 
                const d=e.target.data(); 
                if(d.type==='SubProcess'&&d.subName&&confirm(`"${d.subName}" prosesin…ô ke√ßilsin?`)) switchProcess(d.subName);
            });
        }
    </script>
</body>
</html>

